syntax = "proto3";
package dbplugin;

import "google/protobuf/timestamp.proto";

message InitializeRequest {
	bytes config = 1;
	bool verify_connection = 2;
}

message CreateUserRequest {
	Statements     statements = 1;
	UsernameConfig username_config = 2;
	google.protobuf.Timestamp expiration = 3;
}

message RenewUserRequest {
	Statements statements = 1;
	string username = 2;
	google.protobuf.Timestamp expiration = 3;
}

message RevokeUserRequest {
	Statements statements = 1;
	string username = 2;
}

message RotateRootCredentialsRequest {
	repeated string statements = 1;
}

message Statements {
	repeated string creation_statements = 1;
	repeated string revocation_statements = 2;
	repeated string rollback_statements  = 3;
	repeated string renew_statements = 4;
}

message UsernameConfig {
	string DisplayName = 1;
	string RoleName = 2;
}

message InitializeResponse {
	bytes config = 1;
}

message CreateUserResponse {
	string username = 1;
	string password = 2;
}

message TypeResponse {
    string type = 1;
}

message RotateRootCredentialsResponse {
	bytes config = 1;
}

message Empty {}

service Database {
    rpc Type(Empty) returns (TypeResponse);
    rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
    rpc RenewUser(RenewUserRequest) returns (Empty);
    rpc RevokeUser(RevokeUserRequest) returns (Empty);
    rpc RotateRootCredentials(RotateRootCredentialsRequest) returns (RotateRootCredentialsResponse);
    rpc Initialize(InitializeRequest) returns (InitializeResponse);
    rpc Close(Empty) returns (Empty);
}
